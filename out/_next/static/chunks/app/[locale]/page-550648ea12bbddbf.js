(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[61],{2771:function(e,t,a){Promise.resolve().then(a.bind(a,8278))},8278:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return f}});var s,l,r,i=a(7437),n=a(2265),c=a(9376),o=a(8016),d=a(7776),u=a(1837);function h(e){let{onSuccess:t,onCancel:a,className:s=""}=e,[l,r]=(0,n.useState)(""),[c,o]=(0,n.useState)(""),[h,m]=(0,n.useState)(""),[f,p]=(0,n.useState)(""),[x,v]=(0,n.useState)(""),[N,j]=(0,n.useState)(""),[b,g]=(0,n.useState)(!1),[y,C]=(0,n.useState)("male"),[w,S]=(0,n.useState)(null),[k,E]=(0,n.useState)(!1),M=(0,n.useRef)(null),_=(0,n.useRef)(null),D=(0,n.useRef)(null);(0,n.useEffect)(()=>{var e;null===(e=M.current)||void 0===e||e.focus()},[]);let L=(0,n.useCallback)(()=>{let e="string"==typeof c?parseInt(c,10):c,t="string"==typeof h?parseInt(h,10):h,a="string"==typeof f?parseInt(f,10):f;if(isNaN(e)||isNaN(t)||isNaN(a)||e<1900||e>2100||t<1||t>12||a<1||a>31)return!1;let s=new Date(e,t-1,a);return s.getFullYear()===e&&s.getMonth()===t-1&&s.getDate()===a},[c,h,f]),R=l.trim().length>0&&L(),T=()=>{let e="string"==typeof c?c.padStart(4,"0"):String(c).padStart(4,"0"),t="string"==typeof h?h.padStart(2,"0"):String(h).padStart(2,"0"),a="string"==typeof f?f.padStart(2,"0"):String(f).padStart(2,"0");return"".concat(e,"-").concat(t,"-").concat(a)},P=()=>{if(b||!x&&!N)return;let e=x.padStart(2,"0"),t=N.padStart(2,"0");return"".concat(e,":").concat(t)},F=(0,n.useCallback)(async()=>{if(!R){S("Please fill in all required fields");return}S(null),E(!0);try{let e={name:l.trim(),birth_date:T(),birth_time:P(),gender:y},a=await (0,u.ED)(e);null==t||t({id:a.id,name:a.name})}catch(e){S(e instanceof Error?e.message:"Failed to create profile")}finally{E(!1)}},[R,l,y,T,P,t]),q=(0,n.useCallback)(e=>{("Enter"===e.key||"Tab"===e.key)&&("Enter"===e.key&&e.preventDefault(),setTimeout(()=>{var e;return null===(e=_.current)||void 0===e?void 0:e.focus()},0))},[]),z=(0,n.useCallback)(()=>{setTimeout(()=>{var e;return null===(e=D.current)||void 0===e?void 0:e.focus()},0)},[]),H=(0,n.useCallback)(()=>{},[]);return(0,i.jsxs)(d.RH,{title:"Create New Profile",onSubmit:F,onCancel:a,submitLabel:"Create",cancelLabel:"Cancel",isValid:R,error:w,className:s,children:[(0,i.jsxs)("div",{className:"chat-field",children:[(0,i.jsxs)("div",{className:"chat-field-label-row",children:[(0,i.jsxs)("span",{className:"chat-field-label",children:["Name:",(0,i.jsx)("span",{className:"chat-field-required",children:"*"})]}),(0,i.jsx)("span",{className:"chat-field-cursor chat-field-cursor-active",children:">"})]}),(0,i.jsx)("div",{className:"chat-field-input",children:(0,i.jsx)("input",{ref:M,type:"text",value:l,onChange:e=>r(e.target.value),onKeyDown:q,placeholder:"Enter name",className:"tui-input w-full",disabled:k,autoComplete:"off"})})]}),(0,i.jsxs)("div",{className:"chat-field",children:[(0,i.jsxs)("div",{className:"chat-field-label-row",children:[(0,i.jsxs)("span",{className:"chat-field-label",children:["Birth Date:",(0,i.jsx)("span",{className:"chat-field-required",children:"*"})]}),(0,i.jsx)("span",{className:"chat-field-cursor",children:">"})]}),(0,i.jsx)("div",{className:"chat-field-input",children:(0,i.jsx)(d.YU,{year:c,month:h,day:f,onYearChange:o,onMonthChange:m,onDayChange:p,onComplete:z,disabled:k,hasError:""!==c&&""!==h&&""!==f&&!L(),yearRef:_})}),""!==c&&""!==h&&""!==f&&!L()&&(0,i.jsx)("div",{className:"chat-field-hint chat-field-hint-error",children:"Invalid date"})]}),(0,i.jsxs)("div",{className:"chat-field",children:[(0,i.jsxs)("div",{className:"chat-field-label-row",children:[(0,i.jsxs)("span",{className:"chat-field-label",children:["Birth Time:",(0,i.jsx)("span",{className:"tui-text-muted",style:{fontSize:"0.625rem",marginLeft:"0.25rem"},children:"(optional)"})]}),(0,i.jsx)("span",{className:"chat-field-cursor",children:">"})]}),(0,i.jsx)("div",{className:"chat-field-input",children:(0,i.jsx)(d.L0,{hour:x,minute:N,onHourChange:v,onMinuteChange:j,onComplete:H,disabled:k,showUnknownToggle:!0,isUnknown:b,onUnknownChange:g,hourRef:D})})]}),(0,i.jsxs)("div",{className:"chat-field",children:[(0,i.jsxs)("div",{className:"chat-field-label-row",children:[(0,i.jsxs)("span",{className:"chat-field-label",children:["Gender:",(0,i.jsx)("span",{className:"chat-field-required",children:"*"})]}),(0,i.jsx)("span",{className:"chat-field-cursor",children:">"})]}),(0,i.jsx)("div",{className:"chat-field-input",children:(0,i.jsx)(d.Lk,{value:y,onChange:C,disabled:k})}),(0,i.jsx)("div",{className:"chat-field-hint",children:"Press M or F to select"})]})]})}let m=(null===(l=window.Capacitor)||void 0===l?void 0:null===(s=l.isNativePlatform)||void 0===s?void 0:s.call(l))||(null===(r=window.Capacitor)||void 0===r?void 0:r.platform)!=="web";function f(){let e=(0,c.useRouter)(),[t,a]=(0,n.useState)([]),[s,l]=(0,n.useState)(!0),[r,d]=(0,n.useState)(null),[f,p]=(0,n.useState)(!1),[x,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{v(!m)},[]);let N=(0,n.useCallback)(async()=>{try{l(!0);let e=await (0,u.cp)();a(e),d(null)}catch(e){d(e instanceof Error?e.message:"Failed to load profiles")}finally{l(!1)}},[]);(0,n.useEffect)(()=>{N()},[N]);let j=async(e,s)=>{if(s.stopPropagation(),confirm("Are you sure you want to delete this profile?"))try{await (0,u.he)(e),a(t.filter(t=>t.id!==e))}catch(e){d(e instanceof Error?e.message:"Failed to delete profile")}};return(0,i.jsxs)("div",{className:"min-h-screen tui-bg",children:[(0,i.jsx)(o.Z,{}),(0,i.jsx)("main",{className:"mx-auto main-content px-4 py-6",children:(0,i.jsxs)("div",{className:"mx-auto",style:{maxWidth:"800px"},children:[(0,i.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold tui-text",children:"Profiles"}),!f&&(0,i.jsx)("button",{onClick:()=>p(!0),className:"tui-btn",children:"+ New Profile"})]}),r&&(0,i.jsx)("div",{className:"mb-4 p-3 tui-frame",style:{borderColor:"var(--tui-error)",color:"var(--tui-error)"},children:r}),f&&(0,i.jsx)("div",{className:"mb-6",children:(0,i.jsx)(h,{onSuccess:t=>{p(!1),e.push("/profile/".concat(t.id))},onCancel:()=>p(!1)})}),s?(0,i.jsx)("div",{className:"text-center py-12 tui-text-muted",children:"Loading profiles..."}):0!==t.length||f?(0,i.jsx)("div",{className:"grid gap-4",children:t.map(t=>(0,i.jsx)("div",{onClick:()=>e.push("/profile/".concat(t.id)),className:"tui-frame p-4 cursor-pointer",style:{transition:"border-color 0.15s"},onMouseEnter:e=>e.currentTarget.style.borderColor="var(--tui-water)",onMouseLeave:e=>e.currentTarget.style.borderColor="",children:(0,i.jsxs)("div",{className:"flex justify-between items-start",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"font-semibold text-lg tui-text",children:t.name}),(0,i.jsxs)("p",{className:"text-sm tui-text-dim",children:[t.birth_date,t.birth_time&&" ".concat(t.birth_time)," - ",(0,i.jsx)("span",{style:{color:"female"===t.gender?"var(--tui-accent-pink)":"var(--tui-water)"},children:"female"===t.gender?"♀":"♂"})]})]}),(0,i.jsx)("button",{onClick:e=>j(t.id,e),className:"tui-text-muted p-1",style:{transition:"color 0.15s"},onMouseEnter:e=>e.currentTarget.style.color="var(--tui-fire)",onMouseLeave:e=>e.currentTarget.style.color="",title:"Delete profile",children:(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,i.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})},t.id))}):(0,i.jsxs)("div",{className:"text-center py-12",children:[(0,i.jsx)("p",{className:"tui-text-muted mb-4",children:"No profiles yet"}),(0,i.jsx)("button",{onClick:()=>p(!0),className:"tui-btn",children:"Create your first profile"})]}),x&&(0,i.jsx)("div",{className:"mt-8 pt-4 border-t tui-border-color",children:(0,i.jsx)("a",{href:"/debug",className:"text-sm tui-text-muted",children:"Debug Mode"})})]})})]})}}},function(e){e.O(0,[397,805,159,971,117,744],function(){return e(e.s=2771)}),_N_E=e.O()}]);